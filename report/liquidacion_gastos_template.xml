<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_liquidacion_gastos">
        <t t-call="web.html_container">
            <t t-call="web.basic_layout">
                <div class="page" style="font-family: Arial, sans-serif; font-size: 11px;">

                    <!-- HEADER -->
                    <div class="text-center" style="margin-bottom: 20px;">
                        <h3 style="font-weight: bold; margin-bottom: 5px;">
                            <t t-foreach="companies_data" t-as="cdata">
                                <t t-esc="cdata['company'].name"/><t t-if="not cdata_last"> - </t>
                            </t>
                        </h3>
                        <h4 style="font-weight: bold; margin-bottom: 5px;">
                            LIQUIDACION DE GASTOS DE IMPORTACION
                        </h4>
                        <h5 style="font-weight: bold;">
                            Referencia. <t t-esc="shipment.name"/>
                        </h5>
                    </div>

                    <!-- INFO BOX WITH LOGOS -->
                    <div style="display: flex; margin-bottom: 20px;">
                        <!-- Logos Column -->
                        <div style="width: 25%; padding-right: 15px;">
                            <t t-foreach="companies_data" t-as="cdata">
                                <div style="margin-bottom: 10px;">
                                    <img t-if="cdata['company'].logo"
                                         t-att-src="image_data_uri(cdata['company'].logo)"
                                         style="max-height: 60px; max-width: 150px;"
                                         alt="Logo"/>
                                    <div t-else="" style="font-weight: bold; color: #006666;">
                                        <t t-esc="cdata['company'].name"/>
                                    </div>
                                </div>
                            </t>
                        </div>

                        <!-- Info Column -->
                        <div style="width: 75%;">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 40%; text-align: right; padding-right: 10px; font-weight: bold;">
                                        Lugar y Fecha:
                                    </td>
                                    <td style="border-bottom: 1px solid #000;">
                                        Guatemala, <t t-esc="today" t-options='{"widget": "date"}'/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align: right; padding-right: 10px; font-weight: bold;">
                                        Cliente:
                                    </td>
                                    <td style="border-bottom: 1px solid #000;">
                                        <t t-esc="shipment.partner_id.name"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align: right; padding-right: 10px; font-weight: bold;">
                                        Números de Declaraciones:
                                    </td>
                                    <td style="border-bottom: 1px solid #000;">
                                        <t t-esc="shipment.customs_declaration_number or ''"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align: right; padding-right: 10px; font-weight: bold;">
                                        Naviera:
                                    </td>
                                    <td style="border-bottom: 1px solid #000;">
                                        <t t-esc="shipment.carrier_id.name if shipment.carrier_id else ''"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align: right; padding-right: 10px; font-weight: bold;">
                                        Facturas UCC No.:
                                    </td>
                                    <td style="border-bottom: 1px solid #000;">
                                        <!-- Campo pendiente por definir -->
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align: right; padding-right: 10px; font-weight: bold;">
                                        Tipos de Productos:
                                    </td>
                                    <td style="border-bottom: 1px solid #000;">
                                        <!-- Campo pendiente por definir -->
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <!-- LISTADO POR EMPRESA -->
                    <t t-foreach="companies_data" t-as="cdata">
                        <div style="margin-top: 25px;">
                            <!-- Título de sección -->
                            <h4 class="text-center" style="font-weight: bold; margin-bottom: 10px;">
                                LISTADO DE FACTURAS <t t-esc="cdata['company'].name"/>
                            </h4>

                            <!-- Subtítulo empresa -->
                            <div style="font-weight: bold; margin-bottom: 10px;">
                                <t t-esc="cdata['company'].name"/>
                            </div>

                            <!-- Tabla de facturas -->
                            <table class="table table-sm table-bordered" style="font-size: 9px;">
                                <thead>
                                    <tr style="background-color: #f0f0f0;">
                                        <th style="width: 6%;">F.Envío</th>
                                        <th style="width: 6%;">Fecha</th>
                                        <th style="width: 16%;">Cliente</th>
                                        <th style="width: 8%;">No. FEL</th>
                                        <th style="width: 10%;">Número</th>
                                        <th style="width: 4%;">Mon</th>
                                        <th style="width: 8%; text-align: right;">Total</th>
                                        <th style="width: 6%;">Serie CA</th>
                                        <th style="width: 8%;">No. Fact CA</th>
                                        <th style="width: 9%;">Ref 1</th>
                                        <th style="width: 9%;">Ref 2</th>
                                        <th style="width: 9%;">Ref 3</th>
                                        <th style="width: 9%;">DUCA</th>
                                        <th style="width: 10%;">Embarque</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="cdata['invoices']" t-as="inv">
                                        <tr>
                                            <td><t t-esc="inv.date_sent" t-options='{"widget": "date"}'/></td>
                                            <td><t t-esc="inv.invoice_date" t-options='{"widget": "date"}'/></td>
                                            <td><t t-esc="inv.partner_id.name"/></td>
                                            <td><t t-esc="inv.invoice_number or x_studio_nmero_de_dte or ''"/></td>
                                            <td><t t-esc="inv.name"/></td>
                                            <td><t t-esc="inv.currency_id.name"/></td>
                                            <td style="text-align: right;">
                                                <t t-esc="inv.amount_total" t-options='{"widget": "float", "precision": 2}'/>
                                            </td>
                                            <td>
                                                <t t-esc="gasto.invoice_series or gasto.x_studio_serie or ''"/>
                                            </td>
                                            <td>
                                                <t t-esc="inv.invoice_number or inv.x_studio_nmero_de_dte or ''"/>
                                            </td>
                                            <td><t t-esc="inv.referencia_1 or inv.mrdc_shipment_id.ref_1 or ''"/></td>
                                            <td><t t-esc="inv.referencia_2 or inv.mrdc_shipment_id.ref_2 or ''"/></td>
                                            <td><t t-esc="inv.referencia_3 or inv.mrdc_shipment_id.ref_3 or ''"/></td>
                                            <td><t t-esc="inv.duca or inv.mrdc_shipment_id.customs_declaration_number or ''"/></td>
                                            <td><t t-esc="inv.bl or inv.mrdc_shipment_id.bl_awb_number_manual or ''"/></td>
                                            <td><t t-esc="inv.mrdc_shipment_id.name or inv.embarque_id.name or ''"/></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>

                            <!-- Totales por empresa -->
                            <table style="font-size: 10px; margin-top: 5px;">
                                <tr>
                                    <td style="width: 50%;"></td>
                                    <td style="background-color: #b8d4e8; padding: 5px; font-weight: bold;">
                                        TOTAL A PAGAR <t t-esc="cdata['company'].name"/>
                                    </td>
                                    <td style="padding: 5px; font-weight: bold;">TOTAL</td>
                                    <td style="padding: 5px; font-weight: bold;">Q</td>
                                    <td style="padding: 5px; text-align: right; border-bottom: 1px solid #000;">
                                        <t t-esc="cdata['total_gtq']" t-options='{"widget": "float", "precision": 2}'/>
                                    </td>
                                </tr>
                                <t t-if="cdata['bank_gtq']">
                                    <tr>
                                        <td></td>
                                        <td style="background-color: #b8d4e8; padding: 3px; font-size: 9px;">
                                            Cuenta a Depositar Quetzales # <t t-esc="cdata['bank_gtq'].acc_number"/>
                                        </td>
                                        <td style="padding: 5px; font-weight: bold;">TOTAL</td>
                                        <td style="padding: 5px; font-weight: bold;">$</td>
                                        <td style="padding: 5px; text-align: right; border-bottom: 1px solid #000;">
                                            <t t-esc="cdata['total_usd']" t-options='{"widget": "float", "precision": 2}'/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td style="background-color: #b8d4e8; padding: 3px; font-size: 9px;">
                                            <t t-esc="cdata['bank_gtq'].bank_id.name if cdata['bank_gtq'].bank_id else ''"/>
                                        </td>
                                        <td colspan="3"></td>
                                    </tr>
                                </t>
                                <t t-if="cdata['bank_usd']">
                                    <tr>
                                        <td></td>
                                        <td style="background-color: #b8d4e8; padding: 3px; font-size: 9px;">
                                            Cuenta a Depositar Dolares # <t t-esc="cdata['bank_usd'].acc_number"/>
                                        </td>
                                        <td colspan="3"></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td style="background-color: #b8d4e8; padding: 3px; font-size: 9px;">
                                            <t t-esc="cdata['bank_usd'].bank_id.name if cdata['bank_usd'].bank_id else ''"/>
                                        </td>
                                        <td colspan="3"></td>
                                    </tr>
                                </t>
                            </table>
                        </div>
                    </t>

                    <!-- RESUMEN GENERAL -->
                    <div style="margin-top: 30px;">
                        <table style="width: 100%;">
                            <tr>
                                <td style="width: 60%;">
                                    <h4 style="color: #006666; font-weight: bold;">
                                        <t t-foreach="companies_data" t-as="cdata">
                                            <t t-esc="cdata['company'].name"/><t t-if="not cdata_last"> / </t>
                                        </t>
                                    </h4>
                                </td>
                                <td style="width: 10%; font-weight: bold;">TOTAL:</td>
                                <td style="width: 5%; background-color: #ffffcc; border: 1px solid #000; padding: 5px;">Q</td>
                                <td style="width: 15%; background-color: #ffffcc; border: 1px solid #000; padding: 5px; text-align: right; font-weight: bold;">
                                    <t t-esc="grand_totals['total_gtq']" t-options='{"widget": "float", "precision": 2}'/>
                                </td>
                            </tr>
                            <tr>
                                <td></td>
                                <td style="font-weight: bold;">TOTAL:</td>
                                <td style="background-color: #ffffcc; border: 1px solid #000; padding: 5px;">$</td>
                                <td style="background-color: #ffffcc; border: 1px solid #000; padding: 5px; text-align: right; font-weight: bold;">
                                    <t t-if="grand_totals['total_usd']">
                                        <t t-esc="grand_totals['total_usd']" t-options='{"widget": "float", "precision": 2}'/>
                                    </t>
                                    <t t-else="">-</t>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- CAMPOS DE FIRMA -->
                    <div style="margin-top: 50px;">
                        <p style="margin-bottom: 30px;">
                            <strong>NOMBRE Y APELLIDO:</strong>
                            _______________________________________________________________
                        </p>
                        <p style="margin-bottom: 30px;">
                            <strong>FECHA DE RECIBIDO:</strong>
                            _______________________________________________________________
                        </p>
                        <p>
                            <strong>FIRMA Y SELLO:</strong>
                            _______________________________________________________________
                        </p>
                    </div>
                </div>

                <!-- Los adjuntos (PDFs e imágenes) se concatenan automáticamente al PDF final -->

            </t>
        </t>
    </template>
</odoo>
